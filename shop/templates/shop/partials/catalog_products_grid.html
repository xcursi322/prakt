{% for product in products %}
<div class="product-card-perfect" data-product-name="{{ product.name|lower }}">
    <div class="product-card-perfect-imgwrap">
        <a href="{% url 'shop:product_detail' product.id %}">
            {% if product.image %}
                <img src="{{ product.image.url }}" alt="{{ product.name }}" class="product-card-perfect-img" loading="lazy">
            {% else %}
                <div class="no-image"><i class="fas fa-box"></i></div>
            {% endif %}
        </a>
            {% if product.stock_quantity > 0 %}
                <a class="product-card-perfect-plus" href="{% url 'shop:add_to_cart' product.id %}" data-add-to-cart-url="{% url 'shop:add_to_cart' product.id %}" title="Додати в кошик" aria-label="Додати в кошик">
                    <i class="fas fa-plus"></i>
                </a>
            {% else %}
                <span class="product-card-perfect-plus opacity-50 cursor-not-allowed" title="Товар закінчився" aria-label="Товар закінчився">
                    <i class="fas fa-ban"></i>
                </span>
            {% endif %}
    </div>
    <div class="product-card-perfect-title">{{ product.name }}</div>
    <div class="text-sm text-gray-400 -mt-4 leading-relaxed">{{ product.description|truncatechars:90 }}</div>
    <div class="product-card-perfect-rating">
        <span class="stars">
            {% for i in "12345" %}
                {% if forloop.counter <= product.aggregate_avg_rating|default:0 %}
                    <span class="star-full">&#9733;</span>
                {% else %}
                    <span class="star-empty">&#9733;</span>
                {% endif %}
            {% endfor %}
        </span>
        <span class="rating-count">{{ product.review_count|default:0 }}</span>
    </div>
    <div class="flex items-baseline gap-2">
        <div class="product-card-perfect-price">{{ product.price|floatformat:0 }} ГРН</div>
        {% if product.old_price %}
            <div class="text-sm text-gray-400 line-through">{{ product.old_price|floatformat:0 }} ГРН</div>
        {% endif %}
    </div>
    {% if product.stock_quantity > 0 %}
        <div class="text-sm text-green-600 font-semibold mt-2">В наявності</div>
    {% else %}
        <div class="text-sm text-red-600 font-semibold mt-2">Товар закінчився</div>
    {% endif %}
</div>
{% empty %}
<div class="no-products">Товари не знайдені</div>
{% endfor %}
